name: Ejecutar Análisis - Vulnerabilidades con Snyk

on: 
  push: 
    # Se activa el análisis en cada push al repositorio.
  pull_request: 
    # Se activa el análisis en cada pull request.

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Checkout del código
      - name: Checkout del código
        uses: actions/checkout@v2
        # Obtiene el código fuente del repositorio.

      # Configurar PHP
      - name: Configurar PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.2'  # Ajusta la versión de PHP según sea necesario.
          coverage: none

      # Instalar dependencias de Composer
      - name: Instalar dependencias de Composer
        run: |
          cd biblioteca
          composer install
        # Cambia al directorio biblioteca e instala las dependencias necesarias.

      # Instalar Snyk CLI
      - name: Instalar Snyk CLI
        run: npm install -g snyk
        # Instala la CLI de Snyk para realizar análisis de seguridad.

      # Ejecutar Snyk para verificar vulnerabilidades
      - name: Ejecutar Snyk para verificar vulnerabilidades
        run: |
          cd biblioteca  # Cambiar al directorio donde está composer.json
          snyk test
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}  # Usa el token de Snyk almacenado en secretos.
